Write a "strategy loop" that iterates through everything in a sane way + adds padding.

Use this strategy loop for the naive implementation, too, and allow it to cache m in the same memory.

Optimize the naive implementation as much as possible so as to weed out any doubt that its slowness could come from other places than the extra rounds taken.

Write a proper MitM implementation that caches the computations instead of this half-assery.

Naive implementation still leaks memory
